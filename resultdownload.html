<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>JACKPOT-COM</title>

    <!-- Keep your look & feel -->
    <link href="css/slidingtabs.css" rel="stylesheet" type="text/css" />
    <link href="css/easySlider.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        ul#saturday {
            margin: 0;
            padding: 0;
            list-style-type: none;
            width: auto;
            position: relative;
            display: block;
            height: 36px;
            text-transform: uppercase;
            font-size: 12px;
            font-weight: bold;
            background: transparent url("img/bgOFF.gif") repeat-x top left;
            font-family: Helvetica, Arial, Verdana, sans-serif;
            border-bottom: 4px solid #336666;
            border-top: 1px solid #C0E2D4;
        }

        ul#saturday li {
            display: block;
            float: left;
            margin: 0;
            padding: 0;
        }

        ul#saturday li a {
            display: block;
            float: left;
            color: #874B46;
            text-decoration: none;
            padding: 12px 20px 0 20px;
            height: 24px;
            background: transparent url("img/bgDIVIDER.gif") no-repeat top right;
        }

        ul#saturday li a:hover {
            background: transparent url("img/bgHOVER.gif") no-repeat top right;
        }

        ul#saturday li a.current,
        ul#saturday li a.current:hover {
            color: #fff;
            background: transparent url("img/bgON.gif") no-repeat top right;
        }

        body {
            font-family: "Lucida Grande", "bitstream vera sans", "trebuchet ms", sans-serif, verdana;
            background-image: url("img/innerwrapbg3.jpg");
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            margin: 0;
        }

        a:active {
            outline: none;
        }

        :focus {
            outline-style: none;
            -moz-outline-style: none;
        }

        .textbox {
            background: none;
            color: #874B46;
            border: none;
            cursor: default;
            font-family: 'Trebuchet MS', Arial, Helvetica, sans-serif;
            text-align: center;
            font-size: 20px;
        }

        .label1 {
            background: none;
            color: #000;
            border: none;
            cursor: default;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 15px;
            height: 24px;
        }

        .table1 {
            background: none;
            border: none;
            color: none;
        }

        /* Results table (hidden until search) */
        #download-results-wrap {
            width: 96%;
            margin: 10px auto 40px;
            display: none;
        }

        #resultTable {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
        }

        #resultTable thead th {
            background: #006599;
            color: black;
            padding: 10px;
            border: 2px solid black;
            font-weight: 700;
            border-bottom: 2px solid rgba(0, 0, 0, 0.3);
            text-align: left;
        }

        #resultTable tbody td {
            background: #ffd800;
            color: #1a1a1a;
            padding: 8px;
            border: 2px solid black;
            text-align: center;
            font-weight: 600;
        }

        #resultTable tbody td:first-child,
        #resultTable thead th:first-child {
            width: 60px;
        }

        #resultTable tbody td:nth-child(2),
        #resultTable thead th:nth-child(2) {
            width: 140px;
        }

        @media (max-width:900px) {

            #resultTable thead th,
            #resultTable tbody td {
                padding: 6px;
                font-size: 13px;
            }
        }
    </style>
</head>

<body style="text-align:center">
    <!-- HEADER -->
    <form name="timeform">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <th scope="col"><img src="img/top1.png" width="100%" height="120" alt="Header" /></th>
            </tr>
            <tr align="center">
                <td>
                    <ul id="saturday">
                        <li><a href="/" title="Home">Home</a></li>
                        <li><a href="result" title="Today Result">Today Result</a></li>
                        <li><a href="resultdownload" title="Download Result">Download Result</a></li>
                        <li><a href="#" title="">Schemes</a></li>
                        <li><a href="#" title="">Contact us</a></li>
                        <li><a href="chart" title="">Chart</a></li>
                        <!-- <li>
                            <b class="textbox" style="padding:10px 18px 0;height:24px;float:left;color:#874B46;">
                                <span>DRAW TIME : </span><input type="text" id="displaytime1" name="displaytime1"
                                    size="10" readonly class="textbox" value="11:00:00" />
                                <span>&nbsp;&nbsp;TIME LEFT : </span><input type="text" id="displaytime2"
                                    name="displaytime2" size="10" readonly class="textbox" value="00:00:00" />
                            </b>
                        </li> -->
                    </ul>
                </td>
            </tr>
        </table>
    </form>

    <!-- DATE RANGE FORM -->
    <center>
        <form id="frm_getfile" name="frm_getfile" method="post" style="margin-top:10px;">
            <p style="color:#009">Date: <input autocomplete="off" type="date" id="datepicker" name="datepicker" value=""
                    style="width:180px;" /></p>
            <p style="color:#009">To: <input autocomplete="off" type="date" id="datepicker1" name="datepicker1" value=""
                    style="width:180px;" /></p>
            <input name="Submit" type="submit" class="input-button" value="Result View"
                style="background-color:#9F0;color:#0000FF;cursor:pointer;" />
        </form>
    </center>

    <!-- RESULTS TABLE -->
    <div id="download-results-wrap">
        <table id="resultTable">
            <thead>
                <tr>
                    <th>SLNO</th>
                    <th>DATE</th>
                    <th>11:00</th>
                    <th>12:00</th>
                    <th>01:00</th>
                    <th>02:00</th>
                    <th>04:00</th>
                    <th>06:00</th>
                    <th>07:00</th>
                    <th>08:00</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>

    <!-- jQuery + jQuery UI -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
        (function () {
            'use strict';

            // Firebase config
            const firebaseConfig = {
                apiKey: "AIzaSyBNl9NMqKrmYqY9WPG-v-jAFbiv5d-vef8",
                authDomain: "jackspot-bd84f.firebaseapp.com",
                databaseURL: "https://jackspot-bd84f-default-rtdb.firebaseio.com",
                projectId: "jackspot-bd84f",
                storageBucket: "jackspot-bd84f.firebasestorage.app",
                messagingSenderId: "740333832481",
                appId: "1:740333832481:web:89c6c084af318ed1c01660",
                measurementId: "G-H4QH4TR65X"
            };
            if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
            const db = firebase.database();

            // IST helpers
            function __nowIST() {
                return new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
            }
            function __istDateOnlyYMD(d) {
                const nd = new Date(d.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
                const yyyy = nd.getFullYear(), mm = String(nd.getMonth() + 1).padStart(2, '0'), dd = String(nd.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            }
            function __istDateAt(dateYMD, hhmm) {
                const [y, m, d] = dateYMD.split('-').map(Number);
                const [H, M] = hhmm.split(':').map(Number);
                const t = __nowIST();
                t.setFullYear(y, m - 1, d);
                t.setHours(H, M, 0, 0);
                return t;
            }
            function __isReleased(dateYMD, hhmm) {
                const today = __istDateOnlyYMD(new Date());
                if (dateYMD < today) return true;
                if (dateYMD > today) return false;
                return __nowIST() >= __istDateAt(dateYMD, hhmm);
            }

            // Date generator
            function* __eachDateYMD(fromYMD, toYMD) {
                let cur = new Date(fromYMD + 'T00:00:00');
                const end = new Date(toYMD + 'T00:00:00');
                while (cur <= end) {
                    yield __istDateOnlyYMD(cur);
                    cur.setDate(cur.getDate() + 1);
                }
            }

            const __SLOTS = [
                { t: '11:00' }, { t: '12:00' }, { t: '13:00' }, { t: '14:00' },
                { t: '16:00' }, { t: '18:00' }, { t: '19:00' }, { t: '20:00' },
            ];

            async function __readDateRow(dateYMD) {
                const snap = await db.ref('results/' + dateYMD).get();
                const val = snap.val() || {};
                const latestByTime = {};
                Object.keys(val).sort().forEach(k => {
                    const it = val[k] || {}, t = it.time, n = (it.number || '').toString().replace(/\D/g, '').slice(0, 3);
                    if (!t) return;
                    const prev = latestByTime[t];
                    if (!prev || k > prev._k) latestByTime[t] = { number: n, _k: k };
                });
                let hasAny = false;
                const cells = __SLOTS.map(s => {
                    if (!__isReleased(dateYMD, s.t)) return '';
                    const e = latestByTime[s.t];
                    const num = e && e.number ? e.number.padStart(3, '0') : '';
                    if (num) hasAny = true;
                    return num;
                });
                return { date: dateYMD, cells, hasAny };
            }

            function __renderRows(rows) {
                const wrap = document.getElementById('download-results-wrap');
                const tbody = document.getElementById('resultBody');
                tbody.innerHTML = '';
                rows.forEach((r, i) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${i + 1}</td><td>${r.date}</td>` +
                        r.cells.map(v => `<td>${v}</td>`).join('');
                    tbody.appendChild(tr);
                });
                wrap.style.display = rows.length ? 'block' : 'none';
            }

            // Form submit
            const form = document.getElementById('frm_getfile');
            if (form) {
                form.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const fromYMD = (document.getElementById('datepicker')?.value || '').trim();
                    const toYMD = (document.getElementById('datepicker1')?.value || '').trim();
                    if (!fromYMD || !toYMD) { alert('Please select both From and To dates.'); return; }
                    if (fromYMD > toYMD) { alert('From date cannot be after To date.'); return; }

                    try {
                        const allRows = [];
                        for (const ymd of __eachDateYMD(fromYMD, toYMD)) {
                            allRows.push(await __readDateRow(ymd));
                        }
                        let rows = allRows.filter(r => r.hasAny);

                        const today = __istDateOnlyYMD(new Date());
                        if (rows.length === 0 && (fromYMD <= today && today <= toYMD)) {
                            const trow = await __readDateRow(today);
                            if (trow.hasAny) rows = [trow];
                        }
                        rows.sort((a, b) => a.date.localeCompare(b.date));
                        __renderRows(rows);
                    } catch (err) {
                        console.error(err);
                        alert('Failed to load results. Please try again.');
                    }
                });
            }
        })();
    </script>
</body>

</html>