<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>KingApp7</title>

    <style>
        :root {
            /* ðŸ”§ Set your background image path here */
            --bg: url('img/bg-img.png');

            /* Light lottery palette (no animations) */
            --ink: #1a1a1a;
            --muted: #5c5c5c;
            --gold: #f7c948;
            --gold-deep: #e3a600;
            --red: #e53935;
            --red-deep: #c62828;

            --glass: rgba(255, 255, 255, .88);
            --glass-strong: rgba(255, 255, 255, .96);
            --glass-brd: rgba(0, 0, 0, .10);
            --shadow: 0 10px 28px rgba(0, 0, 0, .12);
            --r-lg: 18px;
            --r-md: 12px;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            margin: 0;
            padding: 0;
            color: var(--ink);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Full-page responsive background image */
        body {
            text-align: center;
            background-image: var(--bg);
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
            min-height: 100dvh;
        }

        /* ===== Page header (added) ===== */
        header {
            position: relative;
            z-index: 2;
            height: 86px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* background:linear-gradient(180deg, var(--glass-strong), rgba(255,255,255,.88)); */
            border-bottom: 1px solid var(--glass-brd);
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
        }

        header h1 {
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 1000;
            font-size: clamp(24px, 4vw, 36px);
            background: linear-gradient(135deg, #8d5c00, #ffdb7a 35%, #fff3c4 55%, #e2a700);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 1px 0 rgba(255, 255, 255, .85);
        }

        /* ===== Top nav (your <ul id="saturday">) ===== */
        #saturday {
            list-style: none;
            margin: 12px auto 0;
            padding: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            background: var(--glass);
            border-radius: var(--r-lg);
            width: min(1200px, 94vw);
            border: 1px solid var(--glass-brd);
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
        }

        #saturday>li {
            display: flex;
            align-items: center;
        }

        #saturday a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            padding: 0 14px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 900;
            color: white;
            background: linear-gradient(180deg, #30b760, #57534a);
            /* border: 1px solid rgba(230, 164, 0, .35); */
            box-shadow: inset 0 1px 0 #fff, 0 6px 14px rgba(247, 201, 72, .16);
        }

        #saturday a:hover {
            color: #7a0f0d;
            background: linear-gradient(180deg, #ffe5e2, #ffd0cc);
            border-color: rgba(229, 57, 53, .35);
            box-shadow: inset 0 1px 0 #fff, 0 6px 14px rgba(229, 57, 53, .16);
        }

        /* ===== Date range form ===== */
        #frm_getfile {
            background: var(--glass);
            border: 1px solid var(--glass-brd);
            border-radius: var(--r-lg);
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
            padding: 14px 16px;
            width: min(700px, 94vw);
        }

        #frm_getfile p {
            margin: 8px 0;
            color: #7a5a12;
            font-weight: 900;
        }

        #frm_getfile input[type="date"] {
            width: 180px;
            height: 38px;
            padding: 0 10px;
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, .12);
            background: linear-gradient(180deg, #ffffff, #f6f6f6);
            color: #1a1a1a;
            font-weight: 600;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, .06);
        }

        .input-button {
            margin-top: 6px;
            height: 42px;
            padding: 0 18px;
            border-radius: 10px;
            border: 1px solid rgba(230, 164, 0, .35);
            background: linear-gradient(180deg, #fff9e9, #ffe1a8);
            color: #6b4b00;
            font-weight: 900;
            cursor: pointer;
            box-shadow: inset 0 1px 0 #fff, 0 6px 14px rgba(247, 201, 72, .16);
        }

        .input-button:hover {
            background: linear-gradient(180deg, #ffe5e2, #ffd0cc);
            color: #7a0f0d;
            border-color: rgba(229, 57, 53, .35);
        }

        /* ===== Results table ===== */
        #download-results-wrap {
            margin: 14px auto 22px;
            width: min(1200px, 96vw);
            background: var(--glass);
            border: 1px solid var(--glass-brd);
            border-radius: var(--r-lg);
            box-shadow: var(--shadow);
            backdrop-filter: blur(6px);
            overflow: hidden;
        }

        /* make the table scrollable on small screens */
        #download-results-wrap {
            overflow: auto;
        }

        #resultTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 14px;
            color: #1a1a1a;
            min-width: 760px;
            /* allow horizontal scroll on tiny screens */
        }

        #resultTable thead th {
            position: sticky;
            top: 0;
            z-index: 1;
            background: linear-gradient(180deg, #fffdf6, #fff2cc);
            color: #6b4b00;
            text-align: center;
            padding: 10px 8px;
            border-bottom: 1px solid rgba(0, 0, 0, .08);
            font-weight: 900;
        }

        #resultTable tbody td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, .06);
            font-weight: 700;
            color: #2a2a2a;
        }

        #resultTable tbody tr:nth-child(odd) {
            background: rgba(255, 255, 255, .72);
        }

        #resultTable tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, .88);
        }

        @media (max-width:720px) {
            #saturday {
                padding: 10px 8px;
            }

            #saturday a {
                height: 38px;
                padding: 0 12px;
            }

            #frm_getfile {
                padding: 12px
            }

            #frm_getfile input[type="date"] {
                width: 160px;
            }

            #resultTable {
                font-size: 13px;
            }
        }
    </style>
</head>

<body style="text-align:center">
    <!-- Header bar -->
    <header>
        <h1>KingApp7</h1>
    </header>

    <!-- HEADER / NAV (kept structure) -->
    <form name="timeform">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr align="center">
                <td>
                    <ul id="saturday">
                        <li><a href="index" title="Home">Home</a></li>
                        <li><a href="result" title="Today Result">Today Result</a></li>
                        <li><a href="resultdownload" title="Download Result">Download Result</a></li>
                        <li><a href="#" title="">Schemes</a></li>
                        <li><a href="#" title="">Contact us</a></li>
                        <li><a href="chart" title="">Chart</a></li>
                        <li><a href="lucky" title="">lucky Spin</a></li>
                    </ul>
                </td>
            </tr>
        </table>
    </form>

    <!-- DATE RANGE FORM (kept, just styled) -->
    <center>
        <form id="frm_getfile" name="frm_getfile" method="post" style="margin-top:10px;">
            <p>Date: <input autocomplete="off" type="date" id="datepicker" name="datepicker" value="" /></p>
            <p>To: <input autocomplete="off" type="date" id="datepicker1" name="datepicker1" value="" /></p>
            <input name="Submit" type="submit" class="input-button" value="Result View" />
        </form>
    </center>

    <!-- RESULTS TABLE (kept) -->
    <div id="download-results-wrap" style="display:none;">
        <table id="resultTable">
            <thead>
                <tr>
                    <th>SLNO</th>
                    <th>DATE</th>
                    <th>11:00</th>
                    <th>12:00</th>
                    <th>01:00</th>
                    <th>02:00</th>
                    <th>04:00</th>
                    <th>06:00</th>
                    <th>07:00</th>
                    <th>08:00</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
        (function () {
            'use strict';

            // Firebase config (kept)
            const firebaseConfig = {
                apiKey: "AIzaSyBNl9NMqKrmYqY9WPG-v-jAFbiv5d-vef8",
                authDomain: "jackspot-bd84f.firebaseapp.com",
                databaseURL: "https://jackspot-bd84f-default-rtdb.firebaseio.com",
                projectId: "jackspot-bd84f",
                storageBucket: "jackspot-bd84f.firebasestorage.app",
                messagingSenderId: "740333832481",
                appId: "1:740333832481:web:89c6c084af318ed1c01660",
                measurementId: "G-H4QH4TR65X"
            };
            if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
            const db = firebase.database();

            // IST helpers (kept)
            function __nowIST() {
                return new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
            }
            function __istDateOnlyYMD(d) {
                const nd = new Date(d.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
                const yyyy = nd.getFullYear(), mm = String(nd.getMonth() + 1).padStart(2, '0'), dd = String(nd.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            }
            function __istDateAt(dateYMD, hhmm) {
                const [y, m, d] = dateYMD.split('-').map(Number);
                const [H, M] = hhmm.split(':').map(Number);
                const t = __nowIST();
                t.setFullYear(y, m - 1, d);
                t.setHours(H, M, 0, 0);
                return t;
            }
            function __isReleased(dateYMD, hhmm) {
                const today = __istDateOnlyYMD(new Date());
                if (dateYMD < today) return true;
                if (dateYMD > today) return false;
                return __nowIST() >= __istDateAt(dateYMD, hhmm);
            }

            // Date generator
            function* __eachDateYMD(fromYMD, toYMD) {
                let cur = new Date(fromYMD + 'T00:00:00');
                const end = new Date(toYMD + 'T00:00:00');
                while (cur <= end) {
                    yield __istDateOnlyYMD(cur);
                    cur.setDate(cur.getDate() + 1);
                }
            }

            const __SLOTS = [
                { t: '11:00' }, { t: '12:00' }, { t: '13:00' }, { t: '14:00' },
                { t: '16:00' }, { t: '18:00' }, { t: '19:00' }, { t: '20:00' },
            ];

            async function __readDateRow(dateYMD) {
                const snap = await db.ref('results/' + dateYMD).get();
                const val = snap.val() || {};
                const latestByTime = {};
                Object.keys(val).sort().forEach(k => {
                    const it = val[k] || {}, t = it.time, n = (it.number || '').toString().replace(/\D/g, '').slice(0, 3);
                    if (!t) return;
                    const prev = latestByTime[t];
                    if (!prev || k > prev._k) latestByTime[t] = { number: n, _k: k };
                });
                let hasAny = false;
                const cells = __SLOTS.map(s => {
                    if (!__isReleased(dateYMD, s.t)) return '';
                    const e = latestByTime[s.t];
                    const num = e && e.number ? e.number.padStart(3, '0') : '';
                    if (num) hasAny = true;
                    return num;
                });
                return { date: dateYMD, cells, hasAny };
            }

            function __renderRows(rows) {
                const wrap = document.getElementById('download-results-wrap');
                const tbody = document.getElementById('resultBody');
                tbody.innerHTML = '';
                rows.forEach((r, i) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${i + 1}</td><td>${r.date}</td>` +
                        r.cells.map(v => `<td>${v}</td>`).join('');
                    tbody.appendChild(tr);
                });
                wrap.style.display = rows.length ? 'block' : 'none';
            }

            // Form submit (kept)
            const form = document.getElementById('frm_getfile');
            if (form) {
                form.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const fromYMD = (document.getElementById('datepicker')?.value || '').trim();
                    const toYMD = (document.getElementById('datepicker1')?.value || '').trim();
                    if (!fromYMD || !toYMD) { alert('Please select both From and To dates.'); return; }
                    if (fromYMD > toYMD) { alert('From date cannot be after To date.'); return; }

                    try {
                        const allRows = [];
                        for (const ymd of __eachDateYMD(fromYMD, toYMD)) {
                            allRows.push(await __readDateRow(ymd));
                        }
                        let rows = allRows.filter(r => r.hasAny);

                        const today = __istDateOnlyYMD(new Date());
                        if (rows.length === 0 && (fromYMD <= today && today <= toYMD)) {
                            const trow = await __readDateRow(today);
                            if (trow.hasAny) rows = [trow];
                        }
                        rows.sort((a, b) => a.date.localeCompare(b.date));
                        __renderRows(rows);
                    } catch (err) {
                        console.error(err);
                        alert('Failed to load results. Please try again.');
                    }
                });
            }
        })();
    </script>
</body>

</html>